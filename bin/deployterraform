#!/usr/bin/env bash

set -e
CURRENT_DIR=$PWD

. '.env'

if [[ -z $DOMAIN ]]; then
	echo "Must specify bucket/domain in .env file."
	echo "Exiting..."
	exit 1
fi

# run infrastructure update
cd $INFRA_DIR || exit 1
# if [[ ! -d .terraform ]]; then
	terraform init
# fi
# if ! terraform env list 2>&1 | grep -qi "$ENVIRONMENT"; then
# 	terraform env new "$ENVIRONMENT"
# fi
# terraform env select "$ENVIRONMENT"

terraform apply \
	-var "domain=$DOMAIN"

cd "$CURRENT_DIR" || exit 1
